<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoviesFinder</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
    #results img { width:200px; border-radius:10px; margin:10px; }
    .movie { margin-bottom:40px; }
    iframe { border-radius:10px; margin-top:10px; }
    .btn { padding:10px 20px; margin:10px; background:#ff3c00; color:#fff; border:none; border-radius:5px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>ðŸŽ¬ MoviesFinder</h1>
  <input type="text" id="search" placeholder="Search for a movie...">
  <button class="btn" onclick="findMovie()">Search</button>
  <div id="results"></div>

  <script>
    const apiKey = "f6bbd78cbc9ce2dd541c4e6f458a5250";

    // function to slugify titles for fmoviesz
    function slugify(title, year) {
      return title
        .toLowerCase()
        .replace(/[^a-z0-9\s]/g, '')   // remove special chars
        .trim()
        .replace(/\s+/g, '-') + '-' + year;
    }

    async function findMovie() {
      let query = document.getElementById("search").value.trim();
      if (!query) {
        alert("Please enter a movie name");
        return;
      }

      // ðŸ”¹ Search TMDB for movie
      let url = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}`;
      let res = await fetch(url);
      let data = await res.json();

      document.getElementById("results").innerHTML = "";

      if (data.results && data.results.length > 0) {
        let movie = data.results[0];
        let year = movie.release_date ? movie.release_date.split("-")[0] : "";

        // ðŸ”¹ Get trailer from TMDB
        let trailerRes = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}/videos?api_key=${apiKey}`);
        let trailerData = await trailerRes.json();
        let trailer = trailerData.results.find(v => v.type === "Trailer" && v.site === "YouTube");

        // ðŸ”¹ Direct Watch Online link (slug)
        let slug = slugify(movie.title, year);
        let watchUrl = `https://fmoviesz.to/movie/${slug}`;
        let watchButton = `<button class="btn" onclick="window.open('${watchUrl}', '_blank')">â–¶ Watch Online</button>`;

        // ðŸ”¹ Get exact YTS movie page
        let ytsUrl = "";
        try {
          let ytsRes = await fetch(`https://yts.mx/api/v2/list_movies.json?query_term=${encodeURIComponent(movie.title + ' ' + year)}`);
          let ytsData = await ytsRes.json();
          if (ytsData.data.movie_count > 0) {
            let ytsMovie = ytsData.data.movies[0];
            ytsUrl = `https://yts.mx/movies/${ytsMovie.slug}`;
          }
        } catch (err) {
          console.error("YTS fetch error:", err);
        }

        let downloadButton = ytsUrl 
          ? `<button class="btn" onclick="window.open('${ytsUrl}', '_blank')">â¬‡ Download</button>`
          : `<button class="btn" onclick="window.open('https://yts.mx/browse-movies/${encodeURIComponent(movie.title + ' ' + year)}', '_blank')">â¬‡ Download</button>`;

        // ðŸ”¹ Show final movie card
        document.getElementById("results").innerHTML = `
          <div class="movie">
            <h2>${movie.title} (${year})</h2>
            <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
            <p>${movie.overview}</p>
            ${trailer ? `<iframe width="560" height="315" src="https://www.youtube.com/embed/${trailer.key}" frameborder="0" allowfullscreen></iframe>` : "<p>No trailer found</p>"}
            <br>
            ${watchButton}
            ${downloadButton}
          </div>
        `;
      } else {
        document.getElementById("results").innerHTML = "<p>No results found</p>";
      }
    }
  </script>
</body>
</html>

